---
title: "過去の特定のコミットを削除する方法"
emoji: "💬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Git]
published: false
---

:::message alert
これは、一人で管理しているリポジトリのみに使用してください。二人以上の開発者が関わっているリポジトリでは行わないでください。もし、過去のコミット等を修正したい場合は、チーム関係者と事前によく話し合ってから決めることをお勧めします。
そもそも、過去のコミットを修正する事自体おすすめできるものではないのでそのことを留意して読んでください。
また、今回紹介する方法は推奨されるやり方ではない可能性があるため、他の情報源にも当たってください。
:::

## 過去の特定のコミットを削除する方法として
- `git rebase -i HEAD~n`(nは自然数で最新のコミットからいくつ戻るか)で特定のコミットを選び、`drop`で削除することができる。rebaseには他にも`squash`や`fixup`等のオプションがあります。
- 特定のコミットの親コミットから新しいブランチを作成する。削除したいコミット以降のコミットを新しいブランチに適用する。元のブランチに切り替えて変更を取り込む。

## 自分の場合
`git rebase`でコンフリクトが多かったこととマージするときにマージコミットが反映されてしまった。削除したいコミットが何故か直ってなかった。上記の障害が起きてしまったので、シンプルに新しいブランチで直してから取り込むことにした。

## やり方
削除したいコミットの親コミットから新しいブランチを作成
```git
git checkout -b <new-branch-name> <parent-commit-id>
```
新しいブランチへの移動
```git
git switch <new-branch-name>
```
元のブランチにある削除したいコミット以降のコミットを新しいブランチに適用。例：`git cherry-pick 1e0cd2..main`でコミットID`1e0cd2`の**次**のコミットからmainの指し示すコミットIDまでを適用できる。
```git
git cherry-pick <commit-id-to-remove>..<orig-branch-name>
```
元のブランチに戻る
```git
git switch <ogirinal-branch-name>
```
新しいブランチの情報で元のブランチの情報を強制的に書き換える。ここでマージなどを行うとコンフリクトが発生してしまう可能性があるので注意する。
```git
git reset --hard <new-branch-name>
```
リモートも強制的に上書き
```git
git push --force origin <original-branch-name>
```


## まとめ
一人でブランチやコミットをこねくり回すには別になんともないかもしれないですが、チーム開発ではおこなわないようにしましょう。一人用のリポジトリですらコンフリクトの修正が大変でした。

## 参考文献
[Git-scmでのbranchについて](https://git-scm.com/docs/git-branch)
[Git-scmでのcherry-pickについて](https://git-scm.com/docs/git-cherry-pick)